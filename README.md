# VideoHosting
#### Проект представляет собой REST API для управления видео, лайками и статистикой. Пользователи могут публиковать видео, ставить лайки, просматривать статистику и управлять медиафайлами. Акцент сделан на аутентификацию, права доступа и работу с гонками при обновлении лайков. Используются Django, DRF, PostgreSQL и токен-аутентификация.
## Эндпоинты
#### Доступные эндпоинты

| Эндпоинт | Метод | Описание |
|----------|-------|----------|
| `/v1/videos/` | `GET` | Список видео (с пагинацией). Авторизованные пользователи видят свои видео + опубликованные. Staff — все видео. |
| `/v1/videos/{id}/` | `GET` | Получение видео по ID. Неавторизованные пользователи видят только опубликованные. |
| `/v1/videos/{id}/likes/` | `POST/DELETE` | Добавление/удаление лайка. Один пользователь может поставить только один лайк на видео. |
| `/v1/videos/ids/` | `GET` | Список ID всех опубликованных видео. Только для staff. |
| `/v1/videos/statistics-subquery/` | `GET` | Статистика: пользователи с количеством лайков (через subquery). Только для staff. |
| `/v1/videos/statistics-group-by/` | `GET` | Статистика: пользователи с количеством лайков (через group by). Только для staff. |

## Запуск
### Запуск проекта производится следующим образом:
##### 1) В корневой папке создать .env по образу и подобию .env.example
##### 2) Запустить скрипт .\script.sh

### Создание тестовых данных (Опционально):
```docker-compose run --rm web-app sh -c "python create_test_data.py"```

### Админ панель:
##### ```http://127.0.0.1:8000/admin/```
##### Логин и пароль из .env

## Аутентификация

#### Отправить Post-запрос на ```http://127.0.0.1:8000/token/``` со следующим боди (JSON):
```{"username": "ваш_логин", "password": "ваш_пароль"}```
###### Или создать токен через админ-панель

### При следующих обращениях к api указывать в headers: 
```Key: Authorization```
```Value: Token ваш_токен```
